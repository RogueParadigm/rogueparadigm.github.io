"use strict";(globalThis.webpackChunkelysmusicengine_docs=globalThis.webpackChunkelysmusicengine_docs||[]).push([[253],{7287(e,n,i){i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"architecture","title":"Architecture Overview","description":"Understanding how ElysMusicEngine works under the hood.","source":"@site/../Documentation/Architecture.md","sourceDirName":".","slug":"/architecture","permalink":"/ElysMusicEngine/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/RogueParadigm/ElysMusicEngine/tree/main/Documentation/../Documentation/Architecture.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"architecture","title":"Architecture Overview","sidebar_position":4},"sidebar":"docsSidebar","previous":{"title":"ERP Music Engine - Quick Start Guide","permalink":"/ElysMusicEngine/QuickStart"},"next":{"title":"Examples and Usage Patterns","permalink":"/ElysMusicEngine/Examples"}}');var s=i(4848),l=i(8453);const c={id:"architecture",title:"Architecture Overview",sidebar_position:4},d="Architecture Overview",t={},o=[{value:"\ud83c\udfaf High-Level Design",id:"-high-level-design",level:2},{value:"\ud83c\udfd7\ufe0f Core Components",id:"\ufe0f-core-components",level:2},{value:"1. Music Subsystem (UERP_MusicSubsystem)",id:"1-music-subsystem-uerp_musicsubsystem",level:3},{value:"2. Music Layer (FERP_MusicLayer)",id:"2-music-layer-ferp_musiclayer",level:3},{value:"3. Active Music Layer (FERP_ActiveMusicLayer)",id:"3-active-music-layer-ferp_activemusiclayer",level:3},{value:"4. Music Layer Config (UERP_MusicLayerConfig)",id:"4-music-layer-config-uerp_musiclayerconfig",level:3},{value:"5. Music Zone (UERP_MusicZoneComponent / AERP_MusicZone)",id:"5-music-zone-uerp_musiczonecomponent--aerp_musiczone",level:3},{value:"\ud83d\udd04 Music Layer Lifecycle",id:"-music-layer-lifecycle",level:2},{value:"Push Layer",id:"push-layer",level:3},{value:"Pop Layer",id:"pop-layer",level:3},{value:"Update Playing Layers (Core Logic)",id:"update-playing-layers-core-logic",level:3},{value:"\ud83c\udf9a\ufe0f Layer Selection Logic",id:"\ufe0f-layer-selection-logic",level:2},{value:"Replace Mode",id:"replace-mode",level:3},{value:"Additive Mode",id:"additive-mode",level:3},{value:"Complex Example",id:"complex-example",level:3},{value:"\ud83d\udd0a Audio Component Pooling",id:"-audio-component-pooling",level:2},{value:"Why Pooling?",id:"why-pooling",level:3},{value:"Pool Size",id:"pool-size",level:3},{value:"Algorithm",id:"algorithm",level:3},{value:"Cleanup",id:"cleanup",level:3},{value:"\ud83c\udfba Stingers &amp; Ducking",id:"-stingers--ducking",level:2},{value:"Stinger Flow",id:"stinger-flow",level:3},{value:"Dialogue Ducking",id:"dialogue-ducking",level:3},{value:"\ud83d\udcbe Persistence Across Levels",id:"-persistence-across-levels",level:2},{value:"How It Works",id:"how-it-works",level:3},{value:"Subsystem Persistence",id:"subsystem-persistence",level:3},{value:"Result",id:"result",level:3},{value:"\ud83e\uddf5 Thread Safety",id:"-thread-safety",level:2},{value:"Game Thread Only",id:"game-thread-only",level:3},{value:"Audio System",id:"audio-system",level:3},{value:"No Locks Needed",id:"no-locks-needed",level:3},{value:"\ud83d\udcca Performance Characteristics",id:"-performance-characteristics",level:2},{value:"CPU Cost",id:"cpu-cost",level:3},{value:"Memory",id:"memory",level:3},{value:"Scalability",id:"scalability",level:3},{value:"\ud83c\udf93 Design Decisions",id:"-design-decisions",level:2},{value:"Why GameInstanceSubsystem?",id:"why-gameinstancesubsystem",level:3},{value:"Why Priority-Based?",id:"why-priority-based",level:3},{value:"Why Soft Object Pointers?",id:"why-soft-object-pointers",level:3},{value:"Why Audio Component Pool?",id:"why-audio-component-pool",level:3},{value:"\ud83d\udd2e Future Extensions (Possible)",id:"-future-extensions-possible",level:2},{value:"Beat Synchronization",id:"beat-synchronization",level:3},{value:"Music Layers (Stems)",id:"music-layers-stems",level:3},{value:"Advanced Crossfade",id:"advanced-crossfade",level:3},{value:"Analytics",id:"analytics",level:3},{value:"\ud83d\udcda Related Documentation",id:"-related-documentation",level:2}];function a(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"architecture-overview",children:"Architecture Overview"})}),"\n",(0,s.jsx)(n.p,{children:"Understanding how ElysMusicEngine works under the hood."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-high-level-design",children:"\ud83c\udfaf High-Level Design"}),"\n",(0,s.jsxs)(n.p,{children:["ElysMusicEngine uses a ",(0,s.jsx)(n.strong,{children:"priority-based layer stack"})," managed by a single ",(0,s.jsx)(n.strong,{children:"GameInstanceSubsystem"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502                 Your Game (Blueprint/C++)              \u2502\r\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\r\n\u2502  \u2502  \u2022 Push Music Layer (combat starts)              \u2502 \u2502\r\n\u2502  \u2502  \u2022 Pop Music Layer (combat ends)                 \u2502 \u2502\r\n\u2502  \u2502  \u2022 Apply Music Config (enter dungeon)            \u2502 \u2502\r\n\u2502  \u2502  \u2022 Play Stinger (achievement unlocked)           \u2502 \u2502\r\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                        \u2502\r\n                        \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502         UERP_MusicSubsystem (GameInstanceSubsystem)    \u2502\r\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\r\n\u2502  \u2502  \u2022 Active Layers (TArray, sorted by priority)    \u2502 \u2502\r\n\u2502  \u2502  \u2022 Audio Component Pool                          \u2502 \u2502\r\n\u2502  \u2502  \u2022 Stinger Component                             \u2502 \u2502\r\n\u2502  \u2502  \u2022 Master Volume State                           \u2502 \u2502\r\n\u2502  \u2502  \u2022 Ducking State                                 \u2502 \u2502\r\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                        \u2502\r\n                        \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502              Active Music Layers (Runtime)             \u2502\r\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\r\n\u2502  \u2502  Boss Music      [Priority 15] Replace  PLAYING  \u2502 \u2502\r\n\u2502  \u2502  Combat Music    [Priority 10] Replace           \u2502 \u2502\r\n\u2502  \u2502  Tension Layer   [Priority 5]  Additive          \u2502 \u2502\r\n\u2502  \u2502  Exploration     [Priority 0]  Replace           \u2502 \u2502\r\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                        \u2502\r\n                        \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502                  Unreal Audio System                   \u2502\r\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\r\n\u2502  \u2502  UAudioComponent (playing Boss Music)            \u2502 \u2502\r\n\u2502  \u2502  UAudioComponent (pooled, inactive)              \u2502 \u2502\r\n\u2502  \u2502  UAudioComponent (pooled, inactive)              \u2502 \u2502\r\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\ufe0f-core-components",children:"\ud83c\udfd7\ufe0f Core Components"}),"\n",(0,s.jsx)(n.h3,{id:"1-music-subsystem-uerp_musicsubsystem",children:"1. Music Subsystem (UERP_MusicSubsystem)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," ",(0,s.jsx)(n.code,{children:"UGameInstanceSubsystem"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Lifetime:"})," Created on GameInstance init, destroyed on shutdown",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Purpose:"})," Central music manager"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Responsibilities:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Maintain stack of active music layers"}),"\n",(0,s.jsx)(n.li,{children:"Sort layers by priority"}),"\n",(0,s.jsx)(n.li,{children:"Determine which layers should play"}),"\n",(0,s.jsx)(n.li,{children:"Crossfade between tracks"}),"\n",(0,s.jsx)(n.li,{children:"Manage audio component pool"}),"\n",(0,s.jsx)(n.li,{children:"Handle stingers and ducking"}),"\n",(0,s.jsx)(n.li,{children:"Persist across level transitions"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Single instance"})," per game"]}),"\n",(0,s.jsxs)(n.li,{children:["Always accessible via ",(0,s.jsx)(n.code,{children:"GetGameInstance()->GetSubsystem<UERP_MusicSubsystem>()"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Thread-safe"})," (all calls on game thread)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-music-layer-ferp_musiclayer",children:"2. Music Layer (FERP_MusicLayer)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," ",(0,s.jsx)(n.code,{children:"USTRUCT"})," (Blueprint-exposed struct)",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Purpose:"})," Define a single music track with metadata"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Fields:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"FName LayerName;                    // Unique identifier\r\nTSoftObjectPtr<USoundBase> Music;   // The music asset (lazy-loaded)\r\nint32 Priority;                     // 0-100 (higher = more important)\r\nERP_EMusicLayerMode LayerMode;      // Replace or Additive\r\nfloat VolumeMultiplier;             // 0.0-1.0\r\nfloat FadeInTime;                   // Seconds\r\nfloat FadeOutTime;                  // Seconds\r\nbool bLooping;                      // Loop music?\r\nbool bPersistAcrossLevels;          // Keep across level loads?\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-active-music-layer-ferp_activemusiclayer",children:"3. Active Music Layer (FERP_ActiveMusicLayer)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," Internal struct (not exposed)",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Purpose:"})," Runtime state for a playing layer"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Fields:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"FERP_MusicLayer LayerData;          // Original layer definition\r\nUAudioComponent* AudioComponent;    // Playing audio component\r\nbool bIsFadingOut;                  // Currently fading out?\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-music-layer-config-uerp_musiclayerconfig",children:"4. Music Layer Config (UERP_MusicLayerConfig)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," ",(0,s.jsx)(n.code,{children:"UDataAsset"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Purpose:"})," Reusable preset with multiple layers"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Fields:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"FString ConfigName;                 // Descriptive name\r\nTArray<FERP_MusicLayer> Layers;     // All layers in this config\r\nfloat DefaultFadeTime;              // Default fade duration\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Menu music setup"}),"\n",(0,s.jsx)(n.li,{children:"Dungeon ambiance (base + wind + tension)"}),"\n",(0,s.jsx)(n.li,{children:"Boss encounter (multiple phases)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"5-music-zone-uerp_musiczonecomponent--aerp_musiczone",children:"5. Music Zone (UERP_MusicZoneComponent / AERP_MusicZone)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," ",(0,s.jsx)(n.code,{children:"UBoxComponent"})," / ",(0,s.jsx)(n.code,{children:"AActor"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Purpose:"})," Level-placed trigger for automatic music"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["On ",(0,s.jsx)(n.strong,{children:"Begin Overlap"})," \u2192 Push music layer"]}),"\n",(0,s.jsxs)(n.li,{children:["On ",(0,s.jsx)(n.strong,{children:"End Overlap"})," \u2192 Pop music layer"]}),"\n",(0,s.jsx)(n.li,{children:"Optional: Filter by actor tag"}),"\n",(0,s.jsx)(n.li,{children:"Optional: Trigger once"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-music-layer-lifecycle",children:"\ud83d\udd04 Music Layer Lifecycle"}),"\n",(0,s.jsx)(n.h3,{id:"push-layer",children:"Push Layer"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'User calls: Push Music Layer("Combat", Priority=10, Replace)\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  1. Check if layer already exists      \u2502\r\n\u2502     \u2192 If yes: Ignore (already playing) \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  2. Create FERP_ActiveMusicLayer       \u2502\r\n\u2502     \u2192 Copy layer data                  \u2502\r\n\u2502     \u2192 AudioComponent = nullptr         \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  3. Add to ActiveLayers array          \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  4. Sort ActiveLayers by Priority      \u2502\r\n\u2502     (Descending: highest first)        \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  5. UpdatePlayingLayers()              \u2502\r\n\u2502     \u2192 Determine what should play       \u2502\r\n\u2502     \u2192 Start/stop audio components      \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n'})}),"\n",(0,s.jsx)(n.h3,{id:"pop-layer",children:"Pop Layer"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'User calls: Pop Music Layer("Combat")\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  1. Find layer by name in ActiveLayers \u2502\r\n\u2502     \u2192 If not found: Warning, return    \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  2. Fade out audio component           \u2502\r\n\u2502     \u2192 FadeOut(FadeOutTime)             \u2502\r\n\u2502     \u2192 Mark bIsFadingOut = true         \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  3. UpdatePlayingLayers()              \u2502\r\n\u2502     \u2192 New music may start playing      \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  4. Layer removal (on next update)     \u2502\r\n\u2502     \u2192 After fade completes             \u2502\r\n\u2502     \u2192 RemoveFadedOutLayers()           \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n'})}),"\n",(0,s.jsx)(n.h3,{id:"update-playing-layers-core-logic",children:"Update Playing Layers (Core Logic)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"UpdatePlayingLayers()\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  1. Remove fully faded out layers      \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  2. Find highest priority Replace layer\u2502\r\n\u2502     \u2192 TopReplacePriority               \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  3. For each layer:                    \u2502\r\n\u2502     If Replace:                        \u2502\r\n\u2502       \u2192 Play if this is top Replace    \u2502\r\n\u2502     If Additive:                       \u2502\r\n\u2502       \u2192 Play if priority >= TopReplace \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  4. Start/stop audio components        \u2502\r\n\u2502     \u2192 GetOrCreateAudioComponent()      \u2502\r\n\u2502     \u2192 SetSound(), Play(), FadeIn()     \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\ufe0f-layer-selection-logic",children:"\ud83c\udf9a\ufe0f Layer Selection Logic"}),"\n",(0,s.jsx)(n.h3,{id:"replace-mode",children:"Replace Mode"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Rule:"})," Only the ",(0,s.jsx)(n.strong,{children:"highest priority"})," Replace layer plays."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Active Layers:\r\n  Combat [10] Replace      \u2190 PLAYS (highest Replace)\r\n  Exploration [0] Replace  \u2190 STOPS (lower priority)\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Reason:"}),' Replace means "this is the main music now."']}),"\n",(0,s.jsx)(n.h3,{id:"additive-mode",children:"Additive Mode"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Rule:"})," Additive layers play if their priority is \u2265 current Replace layer."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Active Layers:\r\n  Combat [10] Replace      \u2190 PLAYS (highest Replace)\r\n  Tension [5] Additive     \u2190 STOPS (5 < 10)\r\n  Rain [12] Additive       \u2190 PLAYS (12 >= 10, adds on top)\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," Combat music + Rain layer play together."]}),"\n",(0,s.jsx)(n.h3,{id:"complex-example",children:"Complex Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Stack:\r\n  Boss [15] Replace        \u2192 PLAYS\r\n  Combat [10] Replace      \u2192 Ignored (lower Replace)\r\n  Tension [12] Additive    \u2192 STOPS (12 < 15)\r\n  Wind [16] Additive       \u2192 PLAYS (16 >= 15, adds on top)\r\n  Exploration [0] Replace  \u2192 Ignored (lower Replace)\r\n\r\nPlaying: Boss Music + Wind Layer\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-audio-component-pooling",children:"\ud83d\udd0a Audio Component Pooling"}),"\n",(0,s.jsx)(n.h3,{id:"why-pooling",children:"Why Pooling?"}),"\n",(0,s.jsxs)(n.p,{children:["Creating/destroying ",(0,s.jsx)(n.code,{children:"UAudioComponent"})," is expensive. We reuse them."]}),"\n",(0,s.jsx)(n.h3,{id:"pool-size",children:"Pool Size"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Dynamic:"})," Grows as needed"]}),"\n",(0,s.jsx)(n.li,{children:"Typical: 2-4 components"}),"\n",(0,s.jsx)(n.li,{children:"Max observed: 10-15 (with many layers)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"algorithm",children:"Algorithm"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"GetOrCreateAudioComponent():\r\n  For each component in pool:\r\n    If not playing:\r\n      Return component (reuse)\r\n  \r\n  // All busy, create new\r\n  NewComponent = NewObject<UAudioComponent>()\r\n  Add to pool\r\n  Return NewComponent\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cleanup",children:"Cleanup"}),"\n",(0,s.jsxs)(n.p,{children:["Components are ",(0,s.jsx)(n.strong,{children:"not"})," destroyed until subsystem shutdown:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Stopped components sit in pool"}),"\n",(0,s.jsx)(n.li,{children:"Reused when next layer needs one"}),"\n",(0,s.jsx)(n.li,{children:"Minimal memory footprint"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-stingers--ducking",children:"\ud83c\udfba Stingers & Ducking"}),"\n",(0,s.jsx)(n.h3,{id:"stinger-flow",children:"Stinger Flow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"User calls: Play Stinger(FanfareSound, bDuck=true, DuckVolume=0.3)\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  1. If bDuckMusic:                     \u2502\r\n\u2502     \u2192 PreDuckVolume = MasterVolume     \u2502\r\n\u2502     \u2192 FadeAllLayersToVolume(0.3)       \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  2. Play stinger on dedicated component\u2502\r\n\u2502     \u2192 StingerComponent->SetSound()     \u2502\r\n\u2502     \u2192 StingerComponent->Play()         \u2502\r\n\u2502     \u2192 Bind OnAudioFinished callback    \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  3. Wait for stinger to finish...      \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  4. OnStingerFinished callback         \u2502\r\n\u2502     \u2192 Restore PreDuckVolume            \u2502\r\n\u2502     \u2192 FadeAllLayersToVolume(1.0)       \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h3,{id:"dialogue-ducking",children:"Dialogue Ducking"}),"\n",(0,s.jsxs)(n.p,{children:["Similar to stinger, but binds to ",(0,s.jsx)(n.strong,{children:"user's"})," ",(0,s.jsx)(n.code,{children:"UAudioComponent"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"EnableDialogueDucking(DialogueComponent, DuckVolume=0.4)\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  1. Duck music to 0.4 volume           \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  2. Bind to DialogueComponent's        \u2502\r\n\u2502     OnAudioFinished                    \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  3. Dialogue plays...                  \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n     \u2502\r\n     \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  4. Dialogue finishes \u2192 callback       \u2502\r\n\u2502     \u2192 Restore music volume             \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-persistence-across-levels",children:"\ud83d\udcbe Persistence Across Levels"}),"\n",(0,s.jsx)(n.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Layer has ",(0,s.jsx)(n.code,{children:"bPersistAcrossLevels = true"})]}),"\n",(0,s.jsxs)(n.li,{children:["Audio component marked with ",(0,s.jsx)(n.code,{children:"bIsMusic = true"})]}),"\n",(0,s.jsxs)(n.li,{children:["Unreal's audio system keeps it alive during:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Level streaming"}),"\n",(0,s.jsx)(n.li,{children:"Map transitions"}),"\n",(0,s.jsx)(n.li,{children:"Level loads"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"subsystem-persistence",children:"Subsystem Persistence"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"UERP_MusicSubsystem"})," is a ",(0,s.jsx)(n.strong,{children:"GameInstanceSubsystem"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Lives for entire game session"}),"\n",(0,s.jsx)(n.li,{children:"Not destroyed on level change"}),"\n",(0,s.jsxs)(n.li,{children:["Keeps ",(0,s.jsx)(n.code,{children:"ActiveLayers"})," array intact"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"result",children:"Result"}),"\n",(0,s.jsxs)(n.p,{children:["Music ",(0,s.jsx)(n.strong,{children:"continues seamlessly"})," when changing levels!"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-thread-safety",children:"\ud83e\uddf5 Thread Safety"}),"\n",(0,s.jsx)(n.h3,{id:"game-thread-only",children:"Game Thread Only"}),"\n",(0,s.jsxs)(n.p,{children:["All public functions ",(0,s.jsx)(n.strong,{children:"must"})," be called from game thread:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Blueprint nodes \u2192 Always game thread \u2705"}),"\n",(0,s.jsx)(n.li,{children:"C++ \u2192 Ensure you're on game thread"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"audio-system",children:"Audio System"}),"\n",(0,s.jsxs)(n.p,{children:["Audio playback happens on ",(0,s.jsx)(n.strong,{children:"audio render thread"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Managed by Unreal's ",(0,s.jsx)(n.code,{children:"AudioMixer"})]}),"\n",(0,s.jsxs)(n.li,{children:["We only control from game thread via ",(0,s.jsx)(n.code,{children:"UAudioComponent"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"no-locks-needed",children:"No Locks Needed"}),"\n",(0,s.jsx)(n.p,{children:"Single-threaded design = no mutexes or locks."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-performance-characteristics",children:"\ud83d\udcca Performance Characteristics"}),"\n",(0,s.jsx)(n.h3,{id:"cpu-cost",children:"CPU Cost"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Operation"}),(0,s.jsx)(n.th,{children:"Cost"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Push Layer"}),(0,s.jsx)(n.td,{children:"Low"}),(0,s.jsx)(n.td,{children:"Array add + sort"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Pop Layer"}),(0,s.jsx)(n.td,{children:"Low"}),(0,s.jsx)(n.td,{children:"Array search + fade"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Update Layers"}),(0,s.jsx)(n.td,{children:"Medium"}),(0,s.jsx)(n.td,{children:"Per-frame check (only on changes)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Stinger"}),(0,s.jsx)(n.td,{children:"Low"}),(0,s.jsx)(n.td,{children:"Single audio component"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Audio Playback"}),(0,s.jsx)(n.td,{children:"Low"}),(0,s.jsx)(n.td,{children:"Handled by AudioMixer"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"memory",children:"Memory"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Item"}),(0,s.jsx)(n.th,{children:"Size"}),(0,s.jsx)(n.th,{children:"Count"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Subsystem"}),(0,s.jsx)(n.td,{children:"~1 KB"}),(0,s.jsx)(n.td,{children:"1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Active Layer"}),(0,s.jsx)(n.td,{children:"~100 bytes"}),(0,s.jsx)(n.td,{children:"2-10 typical"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Audio Component"}),(0,s.jsx)(n.td,{children:"~500 bytes"}),(0,s.jsx)(n.td,{children:"3-15 typical"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Music Asset"}),(0,s.jsx)(n.td,{children:"Varies"}),(0,s.jsx)(n.td,{children:"Loaded on-demand"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Total:"})," ~10-50 KB overhead (negligible)"]}),"\n",(0,s.jsx)(n.h3,{id:"scalability",children:"Scalability"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"2-5 layers:"})," Optimal"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"10 layers:"})," Fine"]}),"\n",(0,s.jsxs)(n.li,{children:["\u26a0\ufe0f ",(0,s.jsx)(n.strong,{children:"20+ layers:"})," Consider consolidation"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-design-decisions",children:"\ud83c\udf93 Design Decisions"}),"\n",(0,s.jsx)(n.h3,{id:"why-gameinstancesubsystem",children:"Why GameInstanceSubsystem?"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Singleton pattern (one instance)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Auto-created by engine"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Persists across levels"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Blueprint-accessible"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"why-priority-based",children:"Why Priority-Based?"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"vs State Machine:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Simpler mental model"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Easy layer stacking"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 No complex transitions"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Indie-friendly"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"why-soft-object-pointers",children:"Why Soft Object Pointers?"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"TSoftObjectPtr<USoundBase>"})," allows:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Lazy loading (only load when needed)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Smaller config assets"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Async loading possible (future)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"why-audio-component-pool",children:"Why Audio Component Pool?"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Avoid create/destroy churn"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Better performance"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Transparent to user"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-future-extensions-possible",children:"\ud83d\udd2e Future Extensions (Possible)"}),"\n",(0,s.jsx)(n.h3,{id:"beat-synchronization",children:"Beat Synchronization"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Add BPM field to ",(0,s.jsx)(n.code,{children:"FERP_MusicLayer"})]}),"\n",(0,s.jsx)(n.li,{children:"Wait for beat before transition"}),"\n",(0,s.jsx)(n.li,{children:"Quantize stingers to beat"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"music-layers-stems",children:"Music Layers (Stems)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Multiple audio files per layer (drums, melody, bass)"}),"\n",(0,s.jsx)(n.li,{children:"Dynamic mixing via volume"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"advanced-crossfade",children:"Advanced Crossfade"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Custom crossfade curves"}),"\n",(0,s.jsx)(n.li,{children:"EQU-based transitions"}),"\n",(0,s.jsx)(n.li,{children:"Musical stingers on transition"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"analytics",children:"Analytics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Track which music plays when"}),"\n",(0,s.jsx)(n.li,{children:"Player preference learning"}),"\n",(0,s.jsx)(n.li,{children:"A/B testing support"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-related-documentation",children:"\ud83d\udcda Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/ElysMusicEngine/setup-guide",children:"Setup Guide"})})," - Getting started"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/ElysMusicEngine/quick-reference",children:"Quick Reference"})})," - Quick lookup"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/ElysMusicEngine/API-Reference",children:"API Reference"})})," - All functions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/ElysMusicEngine/Examples",children:"Examples"})})," - Working patterns"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Now you understand how ElysMusicEngine works!"})," \ud83c\udfb5"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453(e,n,i){i.d(n,{R:()=>c,x:()=>d});var r=i(6540);const s={},l=r.createContext(s);function c(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);