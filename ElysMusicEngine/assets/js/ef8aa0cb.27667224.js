"use strict";(globalThis.webpackChunkelysmusicengine_docs=globalThis.webpackChunkelysmusicengine_docs||[]).push([[791],{8499(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"multiplayer","title":"Multiplayer Guide","description":"How Elys Music Engine handles multiplayer games.","source":"@site/../Documentation/Multiplayer.md","sourceDirName":".","slug":"/multiplayer","permalink":"/ElysMusicEngine/multiplayer","draft":false,"unlisted":false,"editUrl":"https://github.com/RogueParadigm/ElysMusicEngine/tree/main/Documentation/../Documentation/Multiplayer.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"id":"multiplayer","title":"Multiplayer Guide","sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Using from C++","permalink":"/ElysMusicEngine/cpp-usage"},"next":{"title":"API Reference","permalink":"/ElysMusicEngine/API-Reference"}}');var i=r(4848),l=r(8453);const t={id:"multiplayer",title:"Multiplayer Guide",sidebar_position:5},c="Multiplayer Guide",a={},o=[{value:"TL;DR - Quick Facts",id:"tldr---quick-facts",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"Default Behavior: Client-Side Music",id:"default-behavior-client-side-music",level:3},{value:"Common Scenarios",id:"common-scenarios",level:2},{value:"\u2705 Scenario 1: Music Volumes (Default)",id:"-scenario-1-music-volumes-default",level:3},{value:"\u2705 Scenario 2: Gameplay Events (Easy)",id:"-scenario-2-gameplay-events-easy",level:3},{value:"\u2705 Scenario 2.5: Network-Synchronized Music (NEW in v1.2.0)",id:"-scenario-25-network-synchronized-music-new-in-v120",level:3},{value:"\u26a0\ufe0f Scenario 3: Manual Synchronized Timing (Advanced)",id:"\ufe0f-scenario-3-manual-synchronized-timing-advanced",level:3},{value:"Music Volumes: Multiplayer Behavior",id:"music-volumes-multiplayer-behavior",level:2},{value:"Trigger Modes Explained",id:"trigger-modes-explained",level:3},{value:"\ud83d\udd04 <strong>Toggle Mode</strong>",id:"-toggle-mode",level:4},{value:"\u26a1 <strong>Enable/Disable Modes</strong>",id:"-enabledisable-modes",level:4},{value:"\ud83c\udfaf <strong>Actor Filter Tag</strong>",id:"-actor-filter-tag",level:4},{value:"How PlayContext Replication Works (Technical)",id:"how-playcontext-replication-works-technical",level:2},{value:"Replication Architecture",id:"replication-architecture",level:3},{value:"Step-by-Step Example: Music Box in Tavern",id:"step-by-step-example-music-box-in-tavern",level:3},{value:"Network Frequency",id:"network-frequency",level:3},{value:"Late-Joiner Sync Calculation",id:"late-joiner-sync-calculation",level:3},{value:"Replication Authority",id:"replication-authority",level:3},{value:"Handling Disconnections",id:"handling-disconnections",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Problem: Music doesn&#39;t play on clients",id:"problem-music-doesnt-play-on-clients",level:3},{value:"1. Check Authority",id:"1-check-authority",level:4},{value:"2. Use Multicast RPC",id:"2-use-multicast-rpc",level:4},{value:"Problem: Music volumes trigger for wrong player",id:"problem-music-volumes-trigger-for-wrong-player",level:3},{value:"Advanced: Custom Replication",id:"advanced-custom-replication",level:2},{value:"Summary",id:"summary",level:2},{value:"Further Reading",id:"further-reading",level:2}];function d(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"multiplayer-guide",children:"Multiplayer Guide"})}),"\n",(0,i.jsx)(n.p,{children:"How Elys Music Engine handles multiplayer games."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"tldr---quick-facts",children:"TL;DR - Quick Facts"}),"\n",(0,i.jsxs)(n.p,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Works out of the box"})," - No special setup required",(0,i.jsx)(n.br,{}),"\n","\u2705 ",(0,i.jsx)(n.strong,{children:"Client-side by default"})," - Each player controls their own music",(0,i.jsx)(n.br,{}),"\n","\u2705 ",(0,i.jsx)(n.strong,{children:"Zero network traffic"})," - No replication overhead",(0,i.jsx)(n.br,{}),"\n","\u2705 ",(0,i.jsx)(n.strong,{children:"Server-friendly"})," - Dedicated servers don't play music"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,i.jsx)(n.h3,{id:"default-behavior-client-side-music",children:"Default Behavior: Client-Side Music"}),"\n",(0,i.jsxs)(n.p,{children:["Elys Music Engine runs as a ",(0,i.jsx)(n.strong,{children:"Game Instance Subsystem"})," with ",(0,i.jsx)(n.strong,{children:"local execution only"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Server:\r\n  \u274c No music subsystem\r\n  \u274c Volumes don't trigger\r\n  \u274c No audio playback\r\n\r\nClient 1:\r\n  \u2705 Own music subsystem\r\n  \u2705 Volumes trigger locally\r\n  \u2705 Independent playback\r\n\r\nClient 2:\r\n  \u2705 Own music subsystem\r\n  \u2705 Volumes trigger locally\r\n  \u2705 Independent playback\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Why this is good:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u26a1 Zero network bandwidth used"}),"\n",(0,i.jsx)(n.li,{children:"\ud83c\udfae Players can have different music preferences (volume, layers)"}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udda5\ufe0f Server performance unaffected"}),"\n",(0,i.jsx)(n.li,{children:"\ud83c\udfb5 Music continues seamlessly during network issues"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"common-scenarios",children:"Common Scenarios"}),"\n",(0,i.jsx)(n.h3,{id:"-scenario-1-music-volumes-default",children:"\u2705 Scenario 1: Music Volumes (Default)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Setup:"})," Place ",(0,i.jsx)(n.code,{children:"ERP_MusicVolume"})," actors in your level."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Each player triggers volumes ",(0,i.jsx)(n.strong,{children:"when they personally enter"})]}),"\n",(0,i.jsx)(n.li,{children:"Player A in volume \u2192 hears appropriate music"}),"\n",(0,i.jsx)(n.li,{children:"Player B in town \u2192 hears town music"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Perfect for:"})," Open world, exploration, local atmosphere"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"No special code needed"})," - just place volumes and go!"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"-scenario-2-gameplay-events-easy",children:"\u2705 Scenario 2: Gameplay Events (Easy)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Setup:"})," Call music functions from gameplay code (Blueprint/C++)."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example:"})," Boss dies, play victory music"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// In your boss character death function\r\nEvent OnBossDeath\r\n  \u2193\r\n[Authority Only] // Server only\r\n  \u2193\r\nMulticast: PlayVictoryMusic  // All clients execute\r\n  \u2193\r\nGet Music Subsystem\r\n  \u2193\r\nPush Music Layer (Victory_Music)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Blueprint:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Boss death event \u2192 ",(0,i.jsx)(n.code,{children:"Switch Has Authority"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Authority:"})," Call custom Multicast event ",(0,i.jsx)(n.code,{children:"PlayVictoryMusic"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Multicast implementation:"})," ",(0,i.jsx)(n.code,{children:"Push Music Layer"})]}),"\n",(0,i.jsx)(n.li,{children:"All clients hear victory music simultaneously"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Perfect for:"})," Boss fights, level completion, synchronized events"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"-scenario-25-network-synchronized-music-new-in-v120",children:"\u2705 Scenario 2.5: Network-Synchronized Music (NEW in v1.2.0)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Challenge:"})," Make all players hear ",(0,i.jsx)(n.strong,{children:"exactly the same music with automatic sync"}),". Late-joiners should hear the music at the correct point without waiting for it to restart."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Use ",(0,i.jsx)(n.code,{children:"AERP_MusicPlayContext"})," - a replicated actor that synchronizes music across all clients."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"How it works:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Place an ",(0,i.jsx)(n.code,{children:"AERP_MusicPlayContext"})," actor in your level"]}),"\n",(0,i.jsxs)(n.li,{children:["On your ",(0,i.jsx)(n.code,{children:"ERP_MusicVolume"}),", enable ",(0,i.jsx)(n.strong,{children:'"Network Sync"'})," boolean"]}),"\n",(0,i.jsx)(n.li,{children:"When any player triggers the volume, it automatically syncs to all clients"}),"\n",(0,i.jsx)(n.li,{children:"Late-joiners are placed at the correct audio offset"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\ud83c\udfb5 Music boxes that play for all nearby players"}),"\n",(0,i.jsx)(n.li,{children:"\ud83c\udff0 Dungeon boss music that everyone hears in sync"}),"\n",(0,i.jsx)(n.li,{children:"\ud83c\udfad Ambient synchronized music in shared spaces"}),"\n",(0,i.jsx)(n.li,{children:"\ud83c\udfaa Events where timing matters"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Setup:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Place PlayContext in your level:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Add actor: ",(0,i.jsx)(n.code,{children:"ERP_MusicPlayContext"})]}),"\n",(0,i.jsx)(n.li,{children:"Can be hidden or placed anywhere (state syncs globally)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Configure Music Volume:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Create/open your ",(0,i.jsx)(n.code,{children:"ERP_MusicVolume"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Music|Behavior \u2192 Network Sync:"})," Enable \u2705"]}),"\n",(0,i.jsx)(n.li,{children:"When this volume is triggered, music will sync across all clients"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Blueprint Option 1: Using PlayContext directly"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Get Play Context (Find Actor: AERP_MusicPlayContext)\r\n  \u2193\r\nSync Push Music Layer\r\n  \u251c\u2500 Layer: Your music layer\r\n  \u2514\u2500 Quantization: None (optional)\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Blueprint Option 2: Using Push Music Layer with PlayContext param (NEW)"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Get Actor Of Class (AERP_MusicPlayContext) \u2192 PlayContext\r\n  \u2193\r\nGet Music Subsystem\r\n  \u2193\r\nPush Music Layer\r\n  \u251c\u2500 Layer: Your music layer\r\n  \u251c\u2500 Quantization: None (optional)\r\n  \u2514\u2500 PlayContext: PlayContext  \u2190 NEW! Pass PlayContext here\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example: Synchronized Boss Arena Music"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Players enter boss arena volume (Network Sync enabled)\r\n  \u2193\r\nServer receives volume trigger, replicates to all clients\r\n  \u2193\r\nAll clients: See boss music in SyncedLayers\r\n  \u2193\r\nLate-joiner enters after music started:\r\n  \u251c\u2500 Receives replicated SyncedLayers\r\n  \u251c\u2500 Calculates: ElapsedTime = ServerTime - StartTime\r\n  \u251c\u2500 Starts music at that offset\r\n  \u2514\u2500 Hears the exact same point as other players\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Limitations:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Only supports ",(0,i.jsx)(n.code,{children:"SingleLayer"})," and ",(0,i.jsx)(n.code,{children:"LayerList"})," content types (not Presets/Tags yet)"]}),"\n",(0,i.jsx)(n.li,{children:"Stingers are not synchronized (remain client-side)"}),"\n",(0,i.jsxs)(n.li,{children:["Requires ",(0,i.jsx)(n.code,{children:"AERP_MusicPlayContext"})," actor in the level"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Perfect for:"})," Shared atmospheres where timing matters, late-joiner sync, music boxes"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Advanced: Multiple Volumes Triggering Simultaneously"})}),"\n",(0,i.jsx)(n.p,{children:"When two players trigger different synced volumes at the same time:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Player A enters boss arena (Volume 1: "BossMusic")\r\n  \u2193\r\nServer replicates "BossMusic" to playcontext.SyncedLayers[]\r\n  \u2193\r\nAll clients receive replication\r\n  \u2193\r\nPlayer B enters treasure room (Volume 2: "TreasureMusic")\r\n  \u2193\r\nServer replicates "TreasureMusic" to same playcontext\r\n  \u2193\r\nBoth layers coexist in SyncedLayers:\r\n  - BossMusic (Priority: 10, Replace mode)\r\n  - TreasureMusic (Priority: 5, Additive mode)\r\n  \u2193\r\nEach client: BossMusic plays (higher priority), TreasureMusic layered on top\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key behaviors:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Layers are layered by priority (same as local system)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Replace mode discards lower-priority music"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Additive mode stacks on top"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Quartz quantization works across all synced layers"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Late-joiners get all active synced layers instantly"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"\ufe0f-scenario-3-manual-synchronized-timing-advanced",children:"\u26a0\ufe0f Scenario 3: Manual Synchronized Timing (Advanced)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Challenge:"})," Make all players hear the ",(0,i.jsx)(n.strong,{children:"exact same beat/measure"})," in sync."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Use Quartz + RPC with server timestamp"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// Server authoritative timing\r\nServer RPC: StartSyncedMusic\r\n  \u2193\r\nCalculate: StartTime = CurrentTime + 2 seconds  // Network delay buffer\r\n  \u2193\r\nMulticast: PlayMusicAtTime(StartTime, MusicLayer)\r\n  \u2193\r\nEach client: Wait until StartTime, then Push Layer with Quartz\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Blueprint Example:"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Server Function"})," (Custom Event, Run On Server):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Get Music Subsystem\r\n  \u2193\r\nInitialize Quartz Clock\r\n  \u251c\u2500 BPM: 120\r\n  \u2514\u2500 Beat Per Bar: 4\r\n  \u2193\r\nMulticast: BroadcastMusic(LayerData)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Multicast Function"})," (Custom Event, Multicast):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Get Music Subsystem\r\n  \u2193\r\nPush Music Layer Quartz Synced\r\n  \u251c\u2500 Layer: LayerData\r\n  \u251c\u2500 Quantization: Bar\r\n  \u2514\u2500 Fade Time: 2.0\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Perfect for:"})," Rhythm games, synchronized boss phases, musical puzzles"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"music-volumes-multiplayer-behavior",children:"Music Volumes: Multiplayer Behavior"}),"\n",(0,i.jsx)(n.h3,{id:"trigger-modes-explained",children:"Trigger Modes Explained"}),"\n",(0,i.jsxs)(n.h4,{id:"-toggle-mode",children:["\ud83d\udd04 ",(0,i.jsx)(n.strong,{children:"Toggle Mode"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Player A enters \u2192 Music starts ",(0,i.jsx)(n.strong,{children:"for Player A only"})]}),"\n",(0,i.jsxs)(n.li,{children:["Player B enters \u2192 Music starts ",(0,i.jsx)(n.strong,{children:"for Player B only"})]}),"\n",(0,i.jsx)(n.li,{children:"Each player's music is independent"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example:"})," Dungeon entrance"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Player 1 enters dungeon \u2192 hears dungeon music"}),"\n",(0,i.jsx)(n.li,{children:"Player 2 still outside \u2192 hears outdoor music"}),"\n",(0,i.jsx)(n.li,{children:"When Player 2 enters \u2192 dungeon music starts for them too"}),"\n"]}),"\n",(0,i.jsxs)(n.h4,{id:"-enabledisable-modes",children:["\u26a1 ",(0,i.jsx)(n.strong,{children:"Enable/Disable Modes"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"One-shot triggers work the same way"}),"\n",(0,i.jsxs)(n.li,{children:["Each player triggers independently when ",(0,i.jsx)(n.strong,{children:"they"})," enter"]}),"\n"]}),"\n",(0,i.jsxs)(n.h4,{id:"-actor-filter-tag",children:["\ud83c\udfaf ",(0,i.jsx)(n.strong,{children:"Actor Filter Tag"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Filters by ",(0,i.jsx)(n.strong,{children:"entering actor's tags"}),", not player identity"]}),"\n",(0,i.jsx)(n.li,{children:"Works perfectly in multiplayer"}),"\n",(0,i.jsx)(n.li,{children:'Example: Only players with "VIP" tag trigger special music'}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"how-playcontext-replication-works-technical",children:"How PlayContext Replication Works (Technical)"}),"\n",(0,i.jsx)(n.h3,{id:"replication-architecture",children:"Replication Architecture"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Server (Authority)\r\n  \u251c\u2500 AERP_MusicPlayContext actor (bReplicates=true)\r\n  \u2502  \u2514\u2500 SyncedLayers[] array (UPROPERTY Replicated)\r\n  \u2502\r\n  \u2514\u2500 When volume triggers:\r\n     \u2514\u2500 Server calls SyncPushMusicLayer()\r\n        \u2514\u2500 Adds to SyncedLayers[] (automatically replicates to all clients)\r\n\r\nAll Clients (Remote)\r\n  \u251c\u2500 Receive replicated AERP_MusicPlayContext copy\r\n  \u2502  \u2514\u2500 SyncedLayers[] stays in sync with server\r\n  \u2502\r\n  \u2514\u2500 When SyncedLayers[] changes:\r\n     \u2514\u2500 OnRep_SyncedLayers() called\r\n        \u2514\u2500 Calls SyncMusicLayerFromPlayContext() on subsystem\r\n           \u2514\u2500 Music plays locally (no audio streamed)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-by-step-example-music-box-in-tavern",children:"Step-by-Step Example: Music Box in Tavern"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Initial state:"})," Boss room has music box that syncs music to all players nearby."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Timeline:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"T=0:00\r\n  Server: Music box activated\r\n  \u2192 Server_PushMusicLayer(BossMusic) called\r\n\r\nT=0:01\r\n  Server: SyncedLayers[] = [BossMusic]\r\n  \u2192 Replicates to all clients via UE network\r\n\r\nT=0:05\r\n  Player A (already in area):\r\n    \u2705 Receives replication\r\n    \u2705 OnRep_SyncedLayers() called\r\n    \u2705 Plays BossMusic locally\r\n\r\n  Player B (entering from other room):\r\n    \u2705 Receives initial replication (SyncedLayers with BossMusic)\r\n    \u2705 Calculates elapsed time: 5 seconds\r\n    \u2705 Plays BossMusic starting at 5-second offset\r\n    \u2705 Hears same point as Player A \u2713\r\n\r\nT=0:10\r\n  Player C (just spawned):\r\n    \u2705 Immediately gets SyncedLayers state\r\n    \u2705 Joins at 10-second mark\r\n    \u2705 All three players in sync\n"})}),"\n",(0,i.jsx)(n.h3,{id:"network-frequency",children:"Network Frequency"}),"\n",(0,i.jsx)(n.p,{children:"PlayContext updates are optimized:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"NetUpdateFrequency:"})," 10 Hz (layer changes replicate 10 times per second max)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"MinNetUpdateFrequency:"})," 5 Hz (minimum before forcing update)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"bAlwaysRelevant:"})," true (replicates to all players, not just nearby)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"In practice:"})," Layer changes replicate within 100ms to all clients."]}),"\n",(0,i.jsx)(n.h3,{id:"late-joiner-sync-calculation",children:"Late-Joiner Sync Calculation"}),"\n",(0,i.jsx)(n.p,{children:"When a client joins with SyncedLayers already active:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"ElapsedTime = ServerTime - LayerStartTime\r\n\r\nExample:\r\n  Server time: 120.5 seconds\r\n  Layer started: 115.3 seconds\r\n  ElapsedTime = 5.2 seconds\r\n\r\nAction:\r\n  \u2705 Start music playback at 5.2-second mark\r\n  \u2705 All clients hear same audio point\r\n  \u2705 No need to download full track\n"})}),"\n",(0,i.jsx)(n.h3,{id:"replication-authority",children:"Replication Authority"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"What replicates:\r\n  \u2705 SyncedLayers[] array (which layers are active + timestamps)\r\n  \u2705 RPC calls (SyncPushMusicLayer, SyncPopMusicLayer)\r\n\r\nWhat does NOT replicate:\r\n  \u274c Audio data (each client loads from disk)\r\n  \u274c Volume changes (local only)\r\n  \u274c Stingers (client-side only)\r\n\r\nResult: Minimal network traffic, zero audio streaming\n"})}),"\n",(0,i.jsx)(n.h3,{id:"handling-disconnections",children:"Handling Disconnections"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Server: Music playing (in SyncedLayers)\r\n\r\nClient: Connection lost \u2192 Reconnects 10 seconds later\r\n\r\nOn reconnect:\r\n  \u2705 Actor replication restores state\r\n  \u2705 SyncedLayers[] updated to current\r\n  \u2705 Music resumes at correct offset\r\n  \u2705 No desync issues\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"1. Use Client-Side for Atmosphere"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u2705 Ambient volumes (forest, cave, town)\r\n\u2705 Exploration layers\r\n\u2705 UI music (menus, inventory)\r\n\u2705 Local events (pickup items, level up)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"2. Use Multicast RPC for Shared Events"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u2705 Boss phase transitions\r\n\u2705 Victory/defeat music\r\n\u2705 Cutscene music\r\n\u2705 World events (meteor crash, explosion)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:'3. Test with "Play as Client"'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Editor: Settings \u2192 PIE \u2192 Number of Players: 2+"}),"\n",(0,i.jsx)(n.li,{children:"Verify volumes trigger correctly per player"}),"\n",(0,i.jsx)(n.li,{children:"Check that replicated events work on all clients"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"1. Don't Call Music Functions on Server"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u274c Server has no music subsystem\r\n\u274c GetSubsystem returns nullptr on dedicated server\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Fix:"})," Always use ",(0,i.jsx)(n.code,{children:"Switch Has Authority"})," \u2192 Multicast"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"2. Don't Replicate Music State"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u274c No need to replicate which music is playing\r\n\u274c No need to sync volume sliders\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Why:"})," Music is cosmetic, purely client-side concern"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"3. Don't Rely on Perfect Sync Without Quartz"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u274c Network latency varies per client\r\n\u274c Simple RPCs won't sync beats/bars\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Fix:"})," Use Quartz for rhythm-critical gameplay"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"problem-music-doesnt-play-on-clients",children:"Problem: Music doesn't play on clients"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Server/host hears music"}),"\n",(0,i.jsx)(n.li,{children:"Clients hear nothing"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,i.jsx)(n.h4,{id:"1-check-authority",children:"1. Check Authority"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"// \u274c WRONG: Only runs on server\r\nif (HasAuthority())\r\n{\r\n    PushMusicLayer(...);\r\n}\r\n\r\n// \u2705 CORRECT: Runs on all clients\r\n// (Either local call or Multicast RPC)\r\nPushMusicLayer(...);\n"})}),"\n",(0,i.jsx)(n.h4,{id:"2-use-multicast-rpc",children:"2. Use Multicast RPC"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"UFUNCTION(NetMulticast, Reliable)\r\nvoid Multicast_PlayMusic(FERP_MusicLayer Layer);\r\n\r\nvoid AMyActor::TriggerMusic()\r\n{\r\n    if (HasAuthority())\r\n    {\r\n        Multicast_PlayMusic(MyLayer);\r\n    }\r\n}\r\n\r\nvoid AMyActor::Multicast_PlayMusic_Implementation(FERP_MusicLayer Layer)\r\n{\r\n    UERP_MusicSubsystem* MusicSys = GetGameInstance()->GetSubsystem<UERP_MusicSubsystem>();\r\n    if (MusicSys)\r\n    {\r\n        MusicSys->PushMusicLayer(Layer);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"problem-music-volumes-trigger-for-wrong-player",children:"Problem: Music volumes trigger for wrong player"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Player A enters volume"}),"\n",(0,i.jsx)(n.li,{children:"Player B's music changes instead"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.p,{children:"This shouldn't happen - volumes use local overlap events. If it does:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Check your Blueprint: Are you calling music functions on the overlapping actor instead of locally?"}),"\n",(0,i.jsx)(n.li,{children:"Verify actor filter tags are set correctly"}),"\n",(0,i.jsx)(n.li,{children:"Make sure the volume itself isn't replicated weirdly"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Correct pattern:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Volume Overlap Event (runs on each client locally)\r\n  \u2193\r\nCheck: Is overlapping actor local player character?\r\n  \u2193\r\nYES: Push Music Layer (affects THIS client only)\r\nNO: Ignore\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"advanced-custom-replication",children:"Advanced: Custom Replication"}),"\n",(0,i.jsxs)(n.p,{children:["If you need ",(0,i.jsx)(n.strong,{children:"server-authoritative music"})," (rare), create a replicated actor:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"UCLASS(Replicated)\r\nclass AReplicatedMusicController : public AActor\r\n{\r\n    GENERATED_BODY()\r\n\r\n    // Replicated music state\r\n    UPROPERTY(ReplicatedUsing=OnRep_CurrentMusic)\r\n    FName CurrentMusicLayer;\r\n\r\n    // Called on clients when music changes\r\n    UFUNCTION()\r\n    void OnRep_CurrentMusic()\r\n    {\r\n        UERP_MusicSubsystem* MusicSys = GetGameInstance()->GetSubsystem<UERP_MusicSubsystem>();\r\n        if (MusicSys && !CurrentMusicLayer.IsNone())\r\n        {\r\n            // Apply replicated music state\r\n            MusicSys->PushMusicLayerByName(CurrentMusicLayer);\r\n        }\r\n    }\r\n\r\n    // Server function to change music for everyone\r\n    UFUNCTION(BlueprintCallable, BlueprintAuthorityOnly)\r\n    void ServerSetMusic(FName LayerName)\r\n    {\r\n        CurrentMusicLayer = LayerName;\r\n        // Replication automatically updates all clients\r\n    }\r\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"When to use this:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Rhythm games requiring perfect sync"}),"\n",(0,i.jsx)(n.li,{children:"Server-controlled boss music phases"}),"\n",(0,i.jsx)(n.li,{children:"Turn-based games with music tied to game state"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"When NOT to use:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"99% of normal games - default client-side is better"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Feature"}),(0,i.jsx)(n.th,{children:"Multiplayer Support"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Music Volumes"})}),(0,i.jsx)(n.td,{children:"\u2705 Automatic"}),(0,i.jsx)(n.td,{children:"Each client triggers independently"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Music Volumes (Network Sync)"})}),(0,i.jsx)(n.td,{children:"\u2705 NEW!"}),(0,i.jsx)(n.td,{children:'Enable "Network Sync" for synchronized playback'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Push/Pop Layers"})}),(0,i.jsx)(n.td,{children:"\u2705 Client-Side"}),(0,i.jsx)(n.td,{children:"Call locally or via Multicast"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Stingers"})}),(0,i.jsx)(n.td,{children:"\u2705 Client-Side"}),(0,i.jsx)(n.td,{children:"Each client plays independently"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Quartz Sync"})}),(0,i.jsx)(n.td,{children:"\u26a0\ufe0f Manual"}),(0,i.jsx)(n.td,{children:"Use RPC + server timestamp"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Audio Ducking"})}),(0,i.jsx)(n.td,{children:"\u2705 Automatic"}),(0,i.jsx)(n.td,{children:"Works per-client"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Volume Control"})}),(0,i.jsx)(n.td,{children:"\u2705 Client-Side"}),(0,i.jsx)(n.td,{children:"Each player controls own volume"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"PlayContext"})}),(0,i.jsx)(n.td,{children:"\u2705 NEW!"}),(0,i.jsx)(n.td,{children:"Replicated actor for automatic music sync across clients"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Default behavior covers 99% of use cases. Network sync via PlayContext handles shared music scenarios."})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/ElysMusicEngine/API-Reference",children:"API Reference"})," - Music control functions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/ElysMusicEngine/user-guide",children:"User Guide"})," - Music volumes and layers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/ElysMusicEngine/advanced",children:"Advanced Guide"})," - Quartz timing system"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/ElysMusicEngine/troubleshooting",children:"Troubleshooting"})," - Common issues"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>t,x:()=>c});var s=r(6540);const i={},l=s.createContext(i);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);