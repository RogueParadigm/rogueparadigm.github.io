"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[620],{829(e,n,r){r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"PipelineSystem","title":"Pipeline System","description":"Deep dive into the ElysPerceptionPlugin\'s modular Pipeline architecture.","source":"@site/../Documentation/PipelineSystem.md","sourceDirName":".","slug":"/PipelineSystem","permalink":"/ElysPerceptionPlugin/PipelineSystem","draft":false,"unlisted":false,"editUrl":"https://github.com/RogueParadigm/ElysPerceptionPlugin/tree/main/Documentation/../Documentation/PipelineSystem.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"PipelineSystem","title":"Pipeline System","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Setup Guide","permalink":"/ElysPerceptionPlugin/SetupGuide"},"next":{"title":"Interaction Guide","permalink":"/ElysPerceptionPlugin/InteractionGuide"}}');var s=r(4848),t=r(8453);const l={id:"PipelineSystem",title:"Pipeline System",sidebar_position:3},c=void 0,o={},a=[{value:"Overview",id:"overview",level:2},{value:"Core Philosophy",id:"core-philosophy",level:3},{value:"Pipeline Flow",id:"pipeline-flow",level:2},{value:"Execution Flow",id:"execution-flow",level:3},{value:"Pipeline Stages",id:"pipeline-stages",level:2},{value:"Stage 1: Sampler",id:"stage-1-sampler",level:3},{value:"Stage 2: Filters",id:"stage-2-filters",level:3},{value:"Stage 3: Scorers (with Weights)",id:"stage-3-scorers-with-weights",level:3},{value:"Stage 4: Aggregator",id:"stage-4-aggregator",level:3},{value:"Stage 5: Resolver",id:"stage-5-resolver",level:3},{value:"Context System",id:"context-system",level:2},{value:"FERPPerceptionContext",id:"ferpperceptioncontext",level:3},{value:"Multi-Channel Support",id:"multi-channel-support",level:2},{value:"Channel Independence",id:"channel-independence",level:3},{value:"Shared Context",id:"shared-context",level:3},{value:"Domain Components",id:"domain-components",level:3},{value:"Performance",id:"performance",level:2},{value:"Tick Interval",id:"tick-interval",level:3},{value:"Sampler Caching",id:"sampler-caching",level:3},{value:"Optimization Tips",id:"optimization-tips",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Deep dive into the ElysPerceptionPlugin's modular Pipeline architecture."}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"The Pipeline is a modular, data-driven architecture for evaluating perception candidates. Instead of hardcoded perception logic, you configure a series of stages that can be mixed and matched."}),"\n",(0,s.jsx)(n.h3,{id:"core-philosophy",children:"Core Philosophy"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Over Code:"})," Behavior is configured, not coded"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Immutable Context:"})," All stages read from same snapshot"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Pure Functions:"})," Stages evaluate without modifying state"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Independence:"})," Multiple channels run in parallel"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Opt-In:"})," Targets choose to participate via interfaces"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"pipeline-flow",children:"Pipeline Flow"}),"\n",(0,s.jsxs)(n.p,{children:["Every tick (controlled by ",(0,s.jsx)(n.code,{children:"PerceptionTickInterval"}),"), the perception component:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Builds Context"})," - Snapshot of player position, view direction, viewport info"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Runs Each Channel"})," - Target, Interaction, custom channels independently"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Fires Events"})," - Notifies domain components and listeners of changes"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"execution-flow",children:"Execution Flow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"UERPPerceptionComponent::TickComponent()\r\n  |\r\n  v\r\nBuildContext()\r\n  -> Get owner actor (ContextActor)\r\n  -> Get view point (position, rotation)\r\n  -> Extract aim ray\r\n  -> Calculate viewport data + ScreenProjectionPC\r\n  -> Create FERPPerceptionContext\r\n  |\r\n  v\r\nFor each channel:\r\n  |\r\n  v\r\n  Execute Pipeline:\r\n    -> Sampler: Gather candidates (cached per-frame)\r\n    -> Filters: Reject invalid\r\n    -> Scorers: Assign weighted scores\r\n    -> Aggregator: Combine weighted scores (default: sum)\r\n    -> Resolver: Select best (default: lowest score wins)\r\n  |\r\n  v\r\n  Store result (best candidate + score)\r\n  |\r\n  v\r\nFire Events (OnChannelCandidateAcquired/Lost)\r\n  |\r\n  v\r\nDomain components react (OnDomainCandidateChanged)\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"pipeline-stages",children:"Pipeline Stages"}),"\n",(0,s.jsx)(n.h3,{id:"stage-1-sampler",children:"Stage 1: Sampler"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," Collect potential candidate actors from the world."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Input:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"FERPPerceptionContext"})," - Perception context"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"float Range"})," - Maximum detection range"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Output:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"TArray<AActor*>"})," - All candidate actors"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Signature:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"void Sample(const FERPPerceptionContext& Context, float Range, TArray<AActor*>& OutCandidates) const;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Default Implementation:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"UERPSphereOverlapSampler"})," - Sphere overlap query"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Sampler Caching:"})," Results are cached per-frame per context actor. Pipelines sharing the same sampler instance (or using the same ",(0,s.jsx)(n.code,{children:"SamplerCacheId"}),") avoid redundant overlap queries."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"stage-2-filters",children:"Stage 2: Filters"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," Eliminate invalid candidates. ALL filters must pass."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Signature:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"bool Passes(const FERPPerceptionContext& Context, AActor* Candidate) const;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Default Implementations:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"UERPTargetableFilter"})," - Requires IERPTargetable interface"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"UERPInteractableFilter"})," - Requires IERPInteractable interface"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"UERPDistanceFilter"})," - Range-based filtering"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"UERPImplementsInterfaceFilter"})," - Generic interface check"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Filters run in sequence with short-circuit evaluation. If any filter returns false, the candidate is rejected immediately."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"stage-3-scorers-with-weights",children:"Stage 3: Scorers (with Weights)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," Assign numerical scores to candidates. Each scorer has an associated weight."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,s.jsxs)(n.p,{children:["Scorers are configured as ",(0,s.jsx)(n.code,{children:"FERPScorerEntry"})," structs, each containing:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Scorer"})," - The scorer instance (e.g., ",(0,s.jsx)(n.code,{children:"ERPDistanceScorer"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Weight"})," - Multiplier applied to the score (default: 1.0)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The raw score from each scorer is multiplied by its weight before being passed to the aggregator."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Signature:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"float Score(const FERPPerceptionContext& Context, AActor* Candidate) const;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Default Implementations:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"UERPDistanceScorer"})," - Scores by distance (lower = closer = better)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"UERPConeScorer"})," - Scores by angle from forward"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"UERPViewportEllipseScorer"})," - Scores by screen position"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Score Convention:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Lower scores are better (by convention)"}),"\n",(0,s.jsx)(n.li,{children:"Typically normalized to 0.0-1.0"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ERPPipelineScore::RejectScore"})," rejects the candidate entirely"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example with weights:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Candidate A:\r\n  Distance score: 0.3 x weight 2.0 = 0.6\r\n  Angle score:    0.2 x weight 1.0 = 0.2\r\n\r\nCandidate B:\r\n  Distance score: 0.5 x weight 2.0 = 1.0\r\n  Angle score:    0.1 x weight 1.0 = 0.1\r\n\r\nAggregated (sum):\r\n  A: 0.6 + 0.2 = 0.8\r\n  B: 1.0 + 0.1 = 1.1\r\n  -> A wins (lower total)\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"stage-4-aggregator",children:"Stage 4: Aggregator"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," Combine multiple weighted scores into a single final score per candidate."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Signature:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"float Aggregate(const TArray<float>& Scores) const;\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Default behavior"})," (",(0,s.jsx)(n.code,{children:"UERPAggregatorBase"}),"): Sums all weighted scores."]}),"\n",(0,s.jsx)(n.p,{children:"If no Aggregator is configured, the pipeline falls back to summing the weighted scores directly."}),"\n",(0,s.jsxs)(n.p,{children:["You can create custom aggregators for weighted averaging, min/max selection, or non-linear combinations. See ",(0,s.jsx)(n.a,{href:"/ElysPerceptionPlugin/Customization",children:"Customization"}),"."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"stage-5-resolver",children:"Stage 5: Resolver"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," Select the winning candidate from all scored candidates."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Signature:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"bool Resolve(const TArray<FERPPipelineScoredCandidate>& ScoredCandidates, FERPPipelineScoredCandidate& OutBest) const;\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Default behavior"})," (",(0,s.jsx)(n.code,{children:"UERPResolverBase"}),"): Selects the candidate with the lowest score."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"context-system",children:"Context System"}),"\n",(0,s.jsx)(n.h3,{id:"ferpperceptioncontext",children:"FERPPerceptionContext"}),"\n",(0,s.jsx)(n.p,{children:"The context is an immutable snapshot of perception data, built once per tick and shared across all channels."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Contents:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"struct FERPPerceptionContext\r\n{\r\n    AActor* ContextActor;              // Owner (player pawn/controller)\r\n    FVector Origin;                    // Player position\r\n    FVector Forward;                   // Facing direction\r\n\r\n    // Optional aim ray\r\n    bool bHasAimRay;\r\n    FVector AimOrigin;\r\n    FVector AimDirection;\r\n\r\n    // Optional viewport info\r\n    bool bHasViewport;\r\n    FVector2D ViewportSizePx;\r\n\r\n    // Optional screen reference (normalized 0..1)\r\n    bool bHasScreenReference;\r\n    FVector2D ScreenReferenceNdc;\r\n\r\n    // PlayerController for screen projection (viewport scorers)\r\n    APlayerController* ScreenProjectionPC;\r\n};\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Note: ",(0,s.jsx)(n.code,{children:"ContextActor"})," always points to the owning actor (never overwritten). ",(0,s.jsx)(n.code,{children:"ScreenProjectionPC"})," is stored separately for viewport-dependent scorers."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"multi-channel-support",children:"Multi-Channel Support"}),"\n",(0,s.jsx)(n.h3,{id:"channel-independence",children:"Channel Independence"}),"\n",(0,s.jsx)(n.p,{children:"Each channel runs its own complete pipeline:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Own sampler, filters, scorers, aggregator, resolver"}),"\n",(0,s.jsx)(n.li,{children:"Own best candidate"}),"\n",(0,s.jsx)(n.li,{children:"Own events"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"shared-context",children:"Shared Context"}),"\n",(0,s.jsx)(n.p,{children:"While channels are independent, they share the same context snapshot per tick."}),"\n",(0,s.jsx)(n.h3,{id:"domain-components",children:"Domain Components"}),"\n",(0,s.jsx)(n.p,{children:"Each channel typically has a corresponding domain component:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"UERPTargetingComponent"})," for targeting channels"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"UERPInteractionComponent"})," for interaction channels"]}),"\n",(0,s.jsxs)(n.li,{children:["Custom ",(0,s.jsx)(n.code,{children:"UERPDomainComponent"})," subclasses for custom channels"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Domain components auto-bind to perception events and filter by ",(0,s.jsx)(n.code,{children:"ChannelId"}),"."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"performance",children:"Performance"}),"\n",(0,s.jsx)(n.h3,{id:"tick-interval",children:"Tick Interval"}),"\n",(0,s.jsxs)(n.p,{children:["Set ",(0,s.jsx)(n.code,{children:"PerceptionTickInterval"})," on the perception component to control evaluation frequency:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"0.0"})," = every frame (default)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"0.1"})," = 10 Hz"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"0.2"})," = 5 Hz"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"sampler-caching",children:"Sampler Caching"}),"\n",(0,s.jsx)(n.p,{children:"Sampler results are cached per-frame per context actor. Multiple channels sharing the same sampler instance avoid redundant world queries."}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"SamplerCacheId"})," on the pipeline to force cache sharing across channels with different sampler instances."]}),"\n",(0,s.jsx)(n.h3,{id:"optimization-tips",children:"Optimization Tips"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Reduce Sampling Range:"})," Keep ",(0,s.jsx)(n.code,{children:"DefaultSamplingRange"})," reasonable."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use Filters Early:"})," Reject candidates before expensive scoring."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Lightweight Scorers:"})," Keep scoring logic simple."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Scorer Weights:"})," Instead of multiple scorers at weight 1.0, consider if a single well-tuned scorer suffices."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.p,{children:["Learn how to create custom pipeline components in ",(0,s.jsx)(n.a,{href:"/ElysPerceptionPlugin/Customization",children:"Customization"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Create custom domains with ",(0,s.jsx)(n.a,{href:"/ElysPerceptionPlugin/CustomDomains",children:"Custom Domains"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Implement interactions in ",(0,s.jsx)(n.a,{href:"/ElysPerceptionPlugin/InteractionGuide",children:"Interaction Guide"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Check complete API in ",(0,s.jsx)(n.a,{href:"/ElysPerceptionPlugin/API-Reference",children:"API Reference"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>l,x:()=>c});var i=r(6540);const s={},t=i.createContext(s);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);